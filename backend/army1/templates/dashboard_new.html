{% extends 'base_new.html' %}

{% block title %}Command Center - SainyaSecure{% endblock %}
{% block page_title %}Military Command Center{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs text-sm text-gray-400">
    <ul>
        <li><i class="fas fa-home mr-1"></i> Home</li>
        <li>Command Center</li>
    </ul>
</div>
{% endblock %}

{% block content %}
<!-- Real-time Status Bar -->
<div class="bg-gray-800/50 border border-gray-600 rounded-lg p-4 mb-6 flex items-center justify-between">
    <div class="flex items-center gap-6">
        <div class="flex items-center gap-2">
            <span class="status-online"></span>
            <span class="text-sm font-semibold text-green-400">DEFCON 5</span>
        </div>
        <div class="text-sm text-gray-300">
            <i class="fas fa-clock mr-1"></i>
            <span id="current-time">Loading...</span>
        </div>
        <div class="text-sm text-gray-300">
            <i class="fas fa-globe mr-1"></i>
            Operation Secure Shield
        </div>
    </div>
    <div class="flex items-center gap-4">
        <div class="text-sm text-gray-300">
            Last Update: <span class="text-green-400">2 sec ago</span>
        </div>
        <button class="btn btn-sm btn-military">
            <i class="fas fa-sync mr-1"></i>
            REFRESH
        </button>
    </div>
</div>

<!-- Critical Stats Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Active Personnel -->
    <div class="stat-card group">
        <div class="flex items-start justify-between mb-4">
            <div class="p-3 bg-green-500/20 rounded-lg">
                <i class="fas fa-users text-2xl text-green-400"></i>
            </div>
            <div class="text-right">
                <div class="text-xs text-gray-400 uppercase tracking-wider">Personnel</div>
                <div class="text-xs text-green-400">+12% today</div>
            </div>
        </div>
        <div class="stat-number text-green-400">2,847</div>
        <div class="stat-label">Active Personnel</div>
        <div class="mt-3 flex items-center gap-2 text-xs">
            <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded">OPERATIONAL</span>
            <span class="text-gray-400">156 online now</span>
        </div>
    </div>

    <!-- Security Status -->
    <div class="stat-card group">
        <div class="flex items-start justify-between mb-4">
            <div class="p-3 bg-blue-500/20 rounded-lg">
                <i class="fas fa-shield-alt text-2xl text-blue-400"></i>
            </div>
            <div class="text-right">
                <div class="text-xs text-gray-400 uppercase tracking-wider">Security</div>
                <div class="text-xs text-blue-400">All secure</div>
            </div>
        </div>
        <div class="stat-number text-blue-400">98.5<span class="text-lg">%</span></div>
        <div class="stat-label">Security Score</div>
        <div class="mt-3 flex items-center gap-2 text-xs">
            <span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded">SECURE</span>
            <span class="text-gray-400">0 threats detected</span>
        </div>
    </div>

    <!-- Message Traffic -->
    <div class="stat-card group">
        <div class="flex items-start justify-between mb-4">
            <div class="p-3 bg-purple-500/20 rounded-lg">
                <i class="fas fa-paper-plane text-2xl text-purple-400"></i>
            </div>
            <div class="text-right">
                <div class="text-xs text-gray-400 uppercase tracking-wider">Messages</div>
                <div class="text-xs text-purple-400">+24% today</div>
            </div>
        </div>
        <div class="stat-number text-purple-400">1.2<span class="text-lg">M</span></div>
        <div class="stat-label">Messages Today</div>
        <div class="mt-3 flex items-center gap-2 text-xs">
            <span class="px-2 py-1 bg-purple-500/20 text-purple-400 rounded">ACTIVE</span>
            <span class="text-gray-400">847/min avg</span>
        </div>
    </div>

    <!-- Response Time -->
    <div class="stat-card group">
        <div class="flex items-start justify-between mb-4">
            <div class="p-3 bg-orange-500/20 rounded-lg">
                <i class="fas fa-tachometer-alt text-2xl text-orange-400"></i>
            </div>
            <div class="text-right">
                <div class="text-xs text-gray-400 uppercase tracking-wider">Performance</div>
                <div class="text-xs text-orange-400">Excellent</div>
            </div>
        </div>
        <div class="stat-number text-orange-400">0.3<span class="text-lg">s</span></div>
        <div class="stat-label">Response Time</div>
        <div class="mt-3 flex items-center gap-2 text-xs">
            <span class="px-2 py-1 bg-orange-500/20 text-orange-400 rounded">OPTIMAL</span>
            <span class="text-gray-400">99.9% uptime</span>
        </div>
    </div>
</div>

<!-- Main Dashboard Grid -->
<div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
    <!-- Left Column: Device Management -->
    <div class="xl:col-span-2 space-y-6">
        <!-- Device Status -->
        <div class="military-card p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-mobile-alt text-green-400"></i>
                        Device Management
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Real-time device monitoring and control</p>
                </div>
                <div class="flex items-center gap-2">
                    <span class="badge badge-success">156 Online</span>
                    <button class="btn btn-sm btn-ghost">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>

            <!-- Device Categories -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-600">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-2xl font-bold text-blue-400">47</div>
                            <div class="text-sm text-gray-400">Field Radios</div>
                        </div>
                        <i class="fas fa-broadcast-tower text-blue-400 text-xl"></i>
                    </div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-600">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-2xl font-bold text-green-400">23</div>
                            <div class="text-sm text-gray-400">Tablets</div>
                        </div>
                        <i class="fas fa-tablet-alt text-green-400 text-xl"></i>
                    </div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-600">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-2xl font-bold text-purple-400">86</div>
                            <div class="text-sm text-gray-400">Smartphones</div>
                        </div>
                        <i class="fas fa-mobile-alt text-purple-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Active Devices List -->
            <div class="space-y-3">
                <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg border border-gray-600">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-broadcast-tower text-green-400"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-white">Field Unit Alpha-7</div>
                            <div class="text-sm text-gray-400">Radio • Sector 12 • Last seen: 2 min ago</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="status-online"></span>
                        <span class="badge badge-success badge-sm">ONLINE</span>
                        <div class="dropdown dropdown-end">
                            <label tabindex="0" class="btn btn-ghost btn-sm">
                                <i class="fas fa-ellipsis-v"></i>
                            </label>
                            <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-40">
                                <li><a><i class="fas fa-eye mr-2"></i>Monitor</a></li>
                                <li><a><i class="fas fa-cog mr-2"></i>Settings</a></li>
                                <li><a class="text-red-400"><i class="fas fa-ban mr-2"></i>Disable</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg border border-gray-600">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-tablet-alt text-yellow-400"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-white">Command Post Bravo-3</div>
                            <div class="text-sm text-gray-400">Tablet • HQ Building • Pending approval</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="status-warning"></span>
                        <span class="badge badge-warning badge-sm">PENDING</span>
                        <div class="dropdown dropdown-end">
                            <label tabindex="0" class="btn btn-ghost btn-sm">
                                <i class="fas fa-ellipsis-v"></i>
                            </label>
                            <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-40">
                                <li><a class="text-green-400"><i class="fas fa-check mr-2"></i>Approve</a></li>
                                <li><a class="text-red-400"><i class="fas fa-times mr-2"></i>Reject</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg border border-gray-600">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-mobile-alt text-blue-400"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-white">Mobile Unit Charlie-1</div>
                            <div class="text-sm text-gray-400">Smartphone • Patrol Route 7 • Syncing data...</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="loading loading-dots loading-sm text-blue-400"></span>
                        <span class="badge badge-info badge-sm">SYNCING</span>
                        <div class="dropdown dropdown-end">
                            <label tabindex="0" class="btn btn-ghost btn-sm">
                                <i class="fas fa-ellipsis-v"></i>
                            </label>
                            <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-40">
                                <li><a><i class="fas fa-eye mr-2"></i>Monitor</a></li>
                                <li><a><i class="fas fa-sync mr-2"></i>Force Sync</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View All Button -->
            <div class="mt-6 text-center">
                <button class="btn btn-outline btn-sm">
                    <i class="fas fa-list mr-2"></i>
                    View All 156 Devices
                </button>
            </div>
        </div>

        <!-- Communication Analytics -->
        <div class="military-card p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-chart-line text-purple-400"></i>
                        Communication Analytics
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Message traffic and network performance</p>
                </div>
                <div class="flex items-center gap-2">
                    <select class="select select-sm bg-gray-700 border-gray-600">
                        <option>Last 24 hours</option>
                        <option>Last 7 days</option>
                        <option>Last 30 days</option>
                    </select>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="h-64 bg-gray-800/30 rounded-lg p-4 border border-gray-600 mb-4">
                <canvas id="trafficChart" width="100%" height="200"></canvas>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-3 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-400">847</div>
                    <div class="text-xs text-gray-400">MSG/MIN</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-400">99.9%</div>
                    <div class="text-xs text-gray-400">UPTIME</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-400">0.3s</div>
                    <div class="text-xs text-gray-400">LATENCY</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Activities & Alerts -->
    <div class="space-y-6">
        <!-- Security Alerts -->
        <div class="military-card p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-shield-alt text-red-400"></i>
                        Security Alerts
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Real-time threat monitoring</p>
                </div>
                <span class="badge badge-error">LIVE</span>
            </div>

            <div class="space-y-3">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    <div>
                        <div class="text-sm font-semibold">All systems operational</div>
                        <div class="text-xs opacity-70">15:43:27 • System Status</div>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <div class="text-sm font-semibold">3 devices need security updates</div>
                        <div class="text-xs opacity-70">15:40:15 • Device Management</div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <div class="text-sm font-semibold">Scheduled maintenance at 22:00</div>
                        <div class="text-xs opacity-70">15:35:42 • System Maintenance</div>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <button class="btn btn-outline btn-sm w-full">
                    <i class="fas fa-history mr-2"></i>
                    View Alert History
                </button>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="military-card p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-clock text-blue-400"></i>
                        Recent Activity
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Latest system events</p>
                </div>
            </div>

            <div class="space-y-3">
                <div class="activity-item">
                    <div class="w-8 h-8 bg-green-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-user-plus text-green-400 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm text-white">New device registered</div>
                        <div class="text-xs text-gray-400">Field Unit Delta-9 • 2 min ago</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="w-8 h-8 bg-blue-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-paper-plane text-blue-400 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm text-white">Broadcast message sent</div>
                        <div class="text-xs text-gray-400">All units • 5 min ago</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="w-8 h-8 bg-yellow-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-sync text-yellow-400 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm text-white">P2P sync completed</div>
                        <div class="text-xs text-gray-400">47 devices • 8 min ago</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="w-8 h-8 bg-purple-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-brain text-purple-400 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm text-white">AI anomaly scan complete</div>
                        <div class="text-xs text-gray-400">0 threats found • 12 min ago</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="w-8 h-8 bg-red-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-key text-red-400 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm text-white">Encryption keys rotated</div>
                        <div class="text-xs text-gray-400">156 devices • 18 min ago</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="military-card p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-bolt text-yellow-400"></i>
                        Quick Actions
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Emergency controls</p>
                </div>
            </div>

            <div class="space-y-3">
                <button class="btn btn-error w-full justify-start">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    Emergency Broadcast
                </button>
                <button class="btn btn-warning w-full justify-start">
                    <i class="fas fa-lock mr-2"></i>
                    Lockdown Protocol
                </button>
                <button class="btn btn-info w-full justify-start">
                    <i class="fas fa-sync mr-2"></i>
                    Force Sync All
                </button>
                <button class="btn btn-success w-full justify-start">
                    <i class="fas fa-shield-alt mr-2"></i>
                    Security Scan
                </button>
            </div>
        </div>
    </div>
</div>

<!-- System Status Footer -->
<div class="bg-gray-800/30 border border-gray-600 rounded-lg p-4">
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-6 text-sm">
            <div class="flex items-center gap-2">
                <span class="status-online"></span>
                <span class="text-gray-300">System Status: <span class="text-green-400 font-semibold">OPERATIONAL</span></span>
            </div>
            <div class="text-gray-300">
                Uptime: <span class="text-blue-400 font-semibold">99.9%</span>
            </div>
            <div class="text-gray-300">
                Last Backup: <span class="text-purple-400 font-semibold">2 hours ago</span>
            </div>
        </div>
        <div class="text-xs text-gray-400">
            SainyaSecure v2.4.1 • Classification: TOP SECRET/SCI • Build 20241215
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Real-time clock
    function updateTime() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('en-US', { 
            hour12: false,
            timeZoneName: 'short'
        });
        document.getElementById('current-time').textContent = timeStr;
    }
    
    setInterval(updateTime, 1000);
    updateTime();

    // Chart.js for communication analytics
    const ctx = document.getElementById('trafficChart').getContext('2d');
    const trafficChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
            datasets: [
                {
                    label: 'Messages/Hour',
                    data: [120, 80, 200, 450, 680, 520, 300],
                    borderColor: '#00ff88',
                    backgroundColor: 'rgba(0, 255, 136, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Response Time (ms)',
                    data: [300, 280, 250, 290, 320, 280, 260],
                    borderColor: '#0066ff',
                    backgroundColor: 'rgba(0, 102, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#e2e8f0'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(148, 163, 184, 0.1)'
                    },
                    ticks: {
                        color: '#94a3b8'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(148, 163, 184, 0.1)'
                    },
                    ticks: {
                        color: '#94a3b8'
                    }
                }
            }
        }
    });

    // Auto-refresh data every 30 seconds
    setInterval(() => {
        fetch('/api/system-stats/')
            .then(response => response.json())
            .then(data => {
                console.log('Dashboard data updated:', data);
                // Update the chart and stats here
            })
            .catch(error => console.error('Error updating dashboard:', error));
    }, 30000);
</script>
{% endblock %}