{% extends 'base.html' %}

{% block title %}Secure Login - SainyaSecure Military Command Center{% endblock %}

{% block extra_css %}
<style>
    .rank-selection-card {
        background: rgba(26, 31, 46, 0.6);
        border: 1px solid rgba(0, 255, 136, 0.2);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 12px;
        position: relative;
        overflow: hidden;
    }

    .rank-selection-card::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, transparent, rgba(0, 255, 136, 0.1), transparent);
        z-index: -1;
        border-radius: 8px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .rank-selection-card:hover::before {
        opacity: 1;
    }

    .rank-selection-card:hover {
        border-color: var(--primary-color);
        background: rgba(0, 255, 136, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 255, 136, 0.2);
    }

    .rank-selection-card.selected {
        border-color: var(--primary-color);
        background: rgba(0, 255, 136, 0.15);
        box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        transform: scale(1.02);
    }

    .rank-selection-card.selected::before {
        opacity: 1;
        background: linear-gradient(45deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.3), rgba(0, 255, 136, 0.1));
    }

    .login-container {
        background: linear-gradient(135deg, rgba(0, 20, 0, 0.95) 0%, rgba(10, 30, 10, 0.9) 100%);
        border: 2px solid rgba(0, 255, 136, 0.3);
        border-radius: 12px;
        backdrop-filter: blur(15px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(0, 255, 136, 0.1);
        position: relative;
        overflow: hidden;
    }

    .login-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        animation: scanLine 3s infinite;
    }

    @keyframes scanLine {
        0%, 100% { opacity: 0; }
        50% { opacity: 1; }
    }

    .military-input {
        background: rgba(0, 20, 0, 0.6);
        border: 1px solid rgba(0, 255, 136, 0.3);
        color: var(--primary-color);
        padding: 14px 16px;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-family: 'Courier New', monospace;
        font-weight: 500;
    }

    .military-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.2), inset 0 0 0 1px rgba(0, 255, 136, 0.1);
        background: rgba(0, 30, 0, 0.8);
        transform: scale(1.01);
    }

    .military-input::placeholder {
        color: rgba(0, 255, 136, 0.6);
        font-style: italic;
    }

    .rank-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .clearance-high { 
        background: rgba(255, 215, 0, 0.2); 
        color: #ffd700;
        border: 1px solid #ffd700; 
    }
    .clearance-medium { 
        background: rgba(0, 191, 255, 0.2); 
        color: #00bfff;
        border: 1px solid #00bfff; 
    }
    .clearance-low { 
        background: rgba(255, 165, 0, 0.2); 
        color: #ffa500;
        border: 1px solid #ffa500; 
    }

    .security-indicator {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #ffd700;
        box-shadow: 0 0 10px #ffd700;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-6xl">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <div class="mb-6">
                <i class="fas fa-shield-alt text-6xl text-primary-color mb-4 animate-pulse"></i>
            </div>
            <h1 class="text-4xl font-bold text-primary-color mb-2">MILITARY AUTHENTICATION PORTAL</h1>
            <p class="text-secondary-color text-lg">Secure Access Control • Military Personnel Only</p>
            <div class="mt-4 flex justify-center space-x-4">
                <span class="rank-badge clearance-high">TOP SECRET</span>
                <span class="rank-badge clearance-medium">ENCRYPTED</span>
                <span class="rank-badge clearance-low">MONITORED</span>
            </div>
        </div>

        <!-- Login Container -->
        <div class="login-container p-8 relative">
            <div class="security-indicator"></div>
            
            <!-- Alert Messages -->
            {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                <div class="military-card p-4 mb-3 border-l-4 border-red-500 bg-red-900/20 animate-pulse">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-400 mr-3"></i>
                        <span class="text-red-300 font-semibold">{{ message }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Login Form -->
            <form method="post" class="space-y-8" id="loginForm">
                {% csrf_token %}
                
                <!-- Rank Selection Section -->
                <div>
                    <div class="flex items-center justify-center mb-6">
                        <div class="flex items-center">
                            <i class="fas fa-star text-primary-color text-2xl mr-3"></i>
                            <h2 class="text-2xl font-bold text-primary-color">SELECT MILITARY RANK</h2>
                            <i class="fas fa-star text-primary-color text-2xl ml-3"></i>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Command Authority -->
                        <div class="rank-selection-card p-6" data-rank="COMMAND" data-tooltip="Full system access with strategic command capabilities">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-crown text-yellow-400 text-3xl mr-4"></i>
                                <div>
                                    <div class="font-bold text-white text-lg">COMMAND AUTHORITY</div>
                                    <div class="text-sm text-secondary-color">General • Colonel • Major</div>
                                    <div class="rank-badge clearance-high mt-2">TOP SECRET</div>
                                </div>
                            </div>
                            <div class="text-sm text-secondary-color">
                                • Full system access<br>
                                • Personnel management<br>
                                • Strategic operations<br>
                                • <span class="text-yellow-400">Requires 2FA</span>
                            </div>
                        </div>

                        <!-- Operations Officer -->
                        <div class="rank-selection-card p-6" data-rank="OPERATIONS" data-tooltip="Tactical operations and mission planning access">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-cogs text-blue-400 text-3xl mr-4"></i>
                                <div>
                                    <div class="font-bold text-white text-lg">OPERATIONS OFFICER</div>
                                    <div class="text-sm text-secondary-color">Captain • Lieutenant</div>
                                    <div class="rank-badge clearance-medium mt-2">SECRET</div>
                                </div>
                            </div>
                            <div class="text-sm text-secondary-color">
                                • Tactical operations<br>
                                • Mission planning<br>
                                • Unit coordination<br>
                                • Field management
                            </div>
                        </div>

                        <!-- Intelligence Officer -->
                        <div class="rank-selection-card p-6" data-rank="INTELLIGENCE" data-tooltip="Intelligence analysis and security monitoring access">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-eye text-purple-400 text-3xl mr-4"></i>
                                <div>
                                    <div class="font-bold text-white text-lg">INTELLIGENCE OFFICER</div>
                                    <div class="text-sm text-secondary-color">Intel Analyst • Crypto</div>
                                    <div class="rank-badge clearance-high mt-2">TOP SECRET/SCI</div>
                                </div>
                            </div>
                            <div class="text-sm text-secondary-color">
                                • Intelligence analysis<br>
                                • Security monitoring<br>
                                • Threat assessment<br>
                                • <span class="text-purple-400">Requires 2FA</span>
                            </div>
                        </div>

                        <!-- Communications Specialist -->
                        <div class="rank-selection-card p-6" data-rank="COMMUNICATIONS" data-tooltip="Network management and communication systems">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-satellite-dish text-green-400 text-3xl mr-4"></i>
                                <div>
                                    <div class="font-bold text-white text-lg">COMMUNICATIONS SPECIALIST</div>
                                    <div class="text-sm text-secondary-color">Sergeant • Corporal</div>
                                    <div class="rank-badge clearance-medium mt-2">SECRET</div>
                                </div>
                            </div>
                            <div class="text-sm text-secondary-color">
                                • Network management<br>
                                • Secure messaging<br>
                                • Technical support<br>
                                • System monitoring
                            </div>
                        </div>

                        <!-- Field Personnel -->
                        <div class="rank-selection-card p-6" data-rank="FIELD" data-tooltip="Basic communications and field operations">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-user-shield text-orange-400 text-3xl mr-4"></i>
                                <div>
                                    <div class="font-bold text-white text-lg">FIELD PERSONNEL</div>
                                    <div class="text-sm text-secondary-color">Private • Specialist</div>
                                    <div class="rank-badge clearance-low mt-2">CONFIDENTIAL</div>
                                </div>
                            </div>
                            <div class="text-sm text-secondary-color">
                                • Basic communications<br>
                                • Status reporting<br>
                                • Emergency alerts<br>
                                • Equipment checks
                            </div>
                        </div>

                        <!-- Emergency Access -->
                        <div class="rank-selection-card p-6" data-rank="EMERGENCY" data-tooltip="Emergency protocol access - crisis situations only">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-exclamation-triangle text-red-400 text-3xl mr-4"></i>
                                <div>
                                    <div class="font-bold text-white text-lg">EMERGENCY OVERRIDE</div>
                                    <div class="text-sm text-secondary-color">Crisis Situation</div>
                                    <div class="rank-badge clearance-high mt-2" style="background: rgba(255, 0, 0, 0.3); color: #ff4444; border-color: #ff4444;">EMERGENCY</div>
                                </div>
                            </div>
                            <div class="text-sm text-secondary-color">
                                • Emergency access only<br>
                                • Crisis management<br>
                                • Override protocols<br>
                                • <span class="text-red-400">Requires verification</span>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="selected_rank" id="selectedRank" required>
                </div>

                <!-- Credentials Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-primary-color font-semibold mb-3">
                            <i class="fas fa-id-card mr-2"></i>MILITARY ID / USERNAME
                        </label>
                        <input type="text" name="username" placeholder="Enter your military ID" 
                               class="military-input w-full" required>
                        <div class="text-xs text-secondary-color mt-2">
                            <i class="fas fa-info-circle mr-1"></i>Use your assigned military identifier
                        </div>
                    </div>

                    <div>
                        <label class="block text-primary-color font-semibold mb-3">
                            <i class="fas fa-lock mr-2"></i>SECURITY PASSPHRASE
                        </label>
                        <input type="password" name="password" placeholder="Enter secure passphrase" 
                               class="military-input w-full" required>
                        <div class="text-xs text-secondary-color mt-2">
                            <i class="fas fa-shield-alt mr-1"></i>Minimum 8 characters required
                        </div>
                    </div>
                </div>

                <!-- Additional Security Section -->
                <div id="additionalSecurity" class="hidden">
                    <div class="military-card p-4 border-l-4 border-yellow-500 bg-yellow-900/10 mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-key text-yellow-400 mr-3"></i>
                            <span class="text-yellow-300 font-semibold">ENHANCED SECURITY REQUIRED</span>
                            <span class="ml-auto text-xs text-yellow-400">High Clearance Level</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-primary-color font-semibold mb-3">
                            <i class="fas fa-mobile-alt mr-2"></i>TWO-FACTOR AUTHENTICATION CODE
                        </label>
                        <input type="text" name="otp_code" placeholder="Enter 6-digit 2FA code" 
                               class="military-input w-full" maxlength="6" pattern="[0-9]{6}">
                        <div class="text-xs text-secondary-color mt-2">
                            <i class="fas fa-clock mr-1"></i>Code expires in 30 seconds
                        </div>
                    </div>
                </div>

                <!-- Options Section -->
                <div class="flex items-center justify-between p-4 bg-black/20 rounded-lg">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" name="remember_me" class="hidden" id="rememberMe">
                        <div class="relative">
                            <div class="w-12 h-6 bg-gray-700 rounded-full shadow-inner transition-colors duration-300" id="toggleBg"></div>
                            <div class="absolute w-5 h-5 bg-white rounded-full shadow left-0.5 top-0.5 transition-transform duration-300" id="toggleDot"></div>
                        </div>
                        <span class="ml-3 text-secondary-color font-medium">Secure session (30 days)</span>
                    </label>
                    <button type="button" class="text-primary-color hover:text-white text-sm font-semibold transition-colors" onclick="emergencyAccess()">
                        <i class="fas fa-exclamation-triangle mr-1"></i>EMERGENCY PROTOCOL
                    </button>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="control-button w-full py-5 text-xl font-bold relative overflow-hidden group" id="loginBtn" disabled>
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
                    <div class="relative z-10 flex items-center justify-center">
                        <i class="fas fa-sign-in-alt mr-3"></i>
                        <span id="btnText">SELECT RANK TO CONTINUE</span>
                        <i class="fas fa-shield-alt ml-3"></i>
                    </div>
                </button>
            </form>

            <!-- Footer Actions -->
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                <a href="{% url 'join' %}" class="action-btn text-center py-3 group">
                    <i class="fas fa-plus mr-2 group-hover:rotate-90 transition-transform"></i>
                    REGISTER NEW DEVICE
                </a>
                <button class="action-btn py-3 group" onclick="showSecurityInfo()">
                    <i class="fas fa-info-circle mr-2 group-hover:scale-110 transition-transform"></i>
                    SECURITY INFORMATION
                </button>
            </div>
        </div>

        <!-- Security Footer -->
        <div class="mt-8">
            <div class="military-card p-6 border-l-4 border-red-500 bg-red-900/20">
                <div class="flex items-start">
                    <i class="fas fa-exclamation-triangle text-red-400 mr-4 mt-1 text-2xl"></i>
                    <div>
                        <div class="text-red-400 font-bold mb-3 text-lg">⚠️ SECURITY CLASSIFICATION NOTICE ⚠️</div>
                        <p class="text-red-300 text-sm leading-relaxed">
                            This system is for authorized military personnel only. All access attempts are logged, monitored, 
                            and subject to security review. Unauthorized access is strictly prohibited and will result in 
                            immediate security response and potential legal action under military code.
                        </p>
                        <div class="mt-3 flex items-center space-x-4 text-xs text-red-400">
                            <span><i class="fas fa-eye mr-1"></i>Monitored 24/7</span>
                            <span><i class="fas fa-lock mr-1"></i>AES-256 Encrypted</span>
                            <span><i class="fas fa-server mr-1"></i>Audit Logged</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const rankCards = document.querySelectorAll('.rank-selection-card');
        const selectedRankInput = document.getElementById('selectedRank');
        const additionalSecurity = document.getElementById('additionalSecurity');
        const loginBtn = document.getElementById('loginBtn');
        const btnText = document.getElementById('btnText');
        const rememberMe = document.getElementById('rememberMe');
        const toggleBg = document.getElementById('toggleBg');
        const toggleDot = document.getElementById('toggleDot');

        // Initialize tooltips
        rankCards.forEach(card => {
            const tooltip = card.getAttribute('data-tooltip');
            if (tooltip) {
                card.setAttribute('data-tooltip', tooltip);
                card.classList.add('tooltip');
            }
        });

        // Rank selection functionality
        rankCards.forEach(card => {
            card.addEventListener('click', function() {
                rankCards.forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                
                const rank = this.dataset.rank;
                selectedRankInput.value = rank;
                
                // Show additional security for high-clearance ranks
                if (rank === 'COMMAND' || rank === 'INTELLIGENCE' || rank === 'EMERGENCY') {
                    additionalSecurity.classList.remove('hidden');
                    additionalSecurity.querySelector('input').required = true;
                } else {
                    additionalSecurity.classList.add('hidden');
                    additionalSecurity.querySelector('input').required = false;
                }
                
                // Enable login button and update text
                loginBtn.disabled = false;
                loginBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                
                const buttonTexts = {
                    'COMMAND': 'ACCESS COMMAND CENTER',
                    'OPERATIONS': 'ACCESS OPERATIONS DASHBOARD',
                    'INTELLIGENCE': 'ACCESS INTELLIGENCE PORTAL',
                    'COMMUNICATIONS': 'ACCESS COMMUNICATIONS HUB',
                    'FIELD': 'ACCESS FIELD TERMINAL',
                    'EMERGENCY': 'EMERGENCY OVERRIDE ACCESS'
                };
                
                btnText.textContent = buttonTexts[rank];
                
                // Visual feedback
                window.SainyaSecure?.showAlert(`${rank} rank selected. Enter credentials to continue.`, 'success');
            });
        });

        // Remember me toggle
        const label = rememberMe.parentElement;
        label.addEventListener('click', function(e) {
            e.preventDefault();
            rememberMe.checked = !rememberMe.checked;
            
            if (rememberMe.checked) {
                toggleBg.classList.add('bg-primary-color');
                toggleBg.classList.remove('bg-gray-700');
                toggleDot.style.transform = 'translateX(24px)';
            } else {
                toggleBg.classList.remove('bg-primary-color');
                toggleBg.classList.add('bg-gray-700');
                toggleDot.style.transform = 'translateX(0)';
            }
        });

        // Form submission
        const form = document.getElementById('loginForm');
        form.addEventListener('submit', function(e) {
            if (!selectedRankInput.value) {
                e.preventDefault();
                window.SainyaSecure?.showAlert('Please select your military rank first.', 'error');
                return;
            }

            loginBtn.classList.add('loading');
            loginBtn.disabled = true;
            btnText.textContent = 'AUTHENTICATING...';
        });
    });

    function emergencyAccess() {
        const emergencyCard = document.querySelector('[data-rank="EMERGENCY"]');
        if (emergencyCard) {
            emergencyCard.click();
            window.SainyaSecure?.showAlert('🚨 Emergency access protocol activated. Additional verification required.', 'warning');
        }
    }

    function showSecurityInfo() {
        const info = `
🔐 Security Features Active:
• AES-256 Military Grade Encryption
• Multi-Factor Authentication Available
• Real-time Session Monitoring
• Biometric Integration Ready
• Zero Trust Architecture
• Quantum-Resistant Protocols
        `.trim();
        
        window.SainyaSecure?.showAlert(info, 'info');
    }
</script>
{% endblock %}